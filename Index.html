<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CookSaathi - Green Edition</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-green: #63B311;
            --primary-hover: #52960e;
            --bg-dark: #050505;
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg-dark);
            color: #ffffff;
            overflow-x: hidden;
            margin: 0;
        }

        h1,
        h2,
        h3,
        h4,
        nav,
        button,
        .font-heading {
            font-family: 'Poppins', sans-serif;
        }

        /* === SMOOTH WAVE CANVAS === */
        #waveCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
            pointer-events: none;
        }

        /* === GLASS CAPSULE NAVBAR === */
        .glass-capsule {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
            border-radius: 9999px;
        }

        /* The Moving Green Pill */
        #navIndicator {
            position: absolute;
            top: 6px;
            bottom: 6px;
            background: linear-gradient(90deg, #63B311 0%, #4a8a0c 100%);
            border-radius: 9999px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
            opacity: 0;
            /* Hidden initially until moved */
            box-shadow: 0 0 20px rgba(99, 179, 17, 0.4);
        }

        .nav-item {
            position: relative;
            z-index: 10;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: white !important;
        }

        /* === GLASS PANELS === */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: white;
            transition: all 0.3s ease;
        }

        .glass-input:focus {
            border-color: var(--primary-green);
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 15px rgba(99, 179, 17, 0.2);
        }

        /* === FEATURE CARDS (ABOUT US) === */
        .feature-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .feature-card:hover {
            transform: translateY(-5px) scale(1.02);
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(99, 179, 17, 0.3);
            box-shadow: 0 20px 40px -10px rgba(99, 179, 17, 0.15);
        }

        .feature-card:hover .icon-box {
            background: rgba(99, 179, 17, 0.2);
            color: #63B311;
            transform: scale(1.1);
        }

        /* === BUTTONS === */
        .btn-primary {
            background: linear-gradient(135deg, #63B311 0%, #4a8a0c 100%);
            color: #fff;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(99, 179, 17, 0.4);
        }

        /* === CHATBOT STATES === */
        .chef-btn {
            transition: all 0.4s ease;
        }

        .chef-idle {
            background: #1a1a1a;
            border: 2px solid #333;
            color: #666;
        }

        .chef-listening {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid #dc2626;
            color: #ef4444;
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
            animation: pulse-red 2s infinite;
        }

        .chef-answering {
            background: rgba(37, 99, 235, 0.1);
            border: 2px solid #3b82f6;
            color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            animation: pulse-blue 2s infinite;
        }

        .chef-narrating {
            background: rgba(99, 179, 17, 0.1);
            border: 2px solid #63B311;
            color: #63B311;
            box-shadow: 0 0 20px rgba(99, 179, 17, 0.3);
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-red {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
            }

            50% {
                box-shadow: 0 0 0 15px rgba(220, 38, 38, 0.1);
            }
        }

        @keyframes pulse-blue {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }

            50% {
                box-shadow: 0 0 0 15px rgba(59, 130, 246, 0.1);
            }
        }

        @keyframes pulse-green {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(99, 179, 17, 0);
            }

            50% {
                box-shadow: 0 0 0 15px rgba(99, 179, 17, 0.1);
            }
        }

        /* Toggles & Scrollbar */
        .toggle-switch {
            appearance: none;
            width: 40px;
            height: 22px;
            background: #333;
            border-radius: 99px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle-switch:checked {
            background: #63B311;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            background: white;
            transition: 0.3s;
        }

        .toggle-switch:checked::before {
            transform: translateX(18px);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* === FOOTER === */
        .footer-link {
            position: relative;
            color: #9ca3af;
            /* gray-400 */
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .footer-link:hover {
            color: #63B311;
            text-shadow: 0 0 15px rgba(99, 179, 17, 0.8);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <canvas id="waveCanvas"></canvas>
    <!--change-1-->
    <div class="fixed top-6 left-0 w-full z-50 flex justify-center pointer-events-none">
        <nav class="glass-capsule p-1.5 flex items-center pointer-events-auto relative w-full max-w-5xl mx-auto">
            <div id="navIndicator" class="absolute left-0 w-0 rounded-full"></div>

            <div class="flex items-center justify-between w-full relative z-10">

                <div class="flex items-center gap-2 px-4 py-2 cursor-pointer" onclick="switchTab('home', this)">
                    <img src="logo.png"
                        class="w-10 h-10 object-contain drop-shadow-md hover:scale-110 transition-transform duration-300"
                        alt="CookSaathi Logo">
                    <span class="text-sm font-bold tracking-wide text-white font-heading">CookSaathi</span>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex gap-1" id="desktopMenu">
                    <button onclick="switchTab('home', this)" id="nav-home"
                        class="nav-item active px-5 py-2 text-sm font-medium text-white rounded-full hover:text-white/80 transition-colors">Home</button>
                    <button onclick="switchTab('recipes', this)" id="nav-recipes"
                        class="nav-item px-5 py-2 text-sm font-medium text-gray-400 rounded-full hover:text-white transition-colors">World
                        Favorites</button>
                    <button onclick="switchTab('about', this)" id="nav-about"
                        class="nav-item px-5 py-2 text-sm font-medium text-gray-400 rounded-full hover:text-white transition-colors">About
                        Us</button>
                    <button onclick="switchTab('faq', this)" id="nav-faq"
                        class="nav-item px-5 py-2 text-sm font-medium text-gray-400 rounded-full hover:text-white transition-colors">Help
                    </button>
                </div>

                <!-- Hamburger Button -->
                <div class="md:hidden pr-4">
                    <button id="mobileMenuBtn" onclick="toggleMobileMenu()" class="text-white focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Dropdown -->
            <div id="mobileMenu"
                class="absolute top-16 right-0 w-48 glass-panel rounded-xl flex flex-col items-start p-2 gap-1 hidden md:hidden transition-all duration-300 transform origin-top-right scale-95 opacity-0">
                <button onclick="mobileSwitchTab('home', this)"
                    class="w-full text-left px-4 py-2 text-sm font-medium text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors">Home</button>
                <button onclick="mobileSwitchTab('recipes', this)"
                    class="w-full text-left px-4 py-2 text-sm font-medium text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors">World
                    Favorites</button>
                <button onclick="mobileSwitchTab('about', this)"
                    class="w-full text-left px-4 py-2 text-sm font-medium text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors">About
                    Us</button>
                <button onclick="mobileSwitchTab('faq', this)"
                    class="w-full text-left px-4 py-2 text-sm font-medium text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors">Help</button>
            </div>
    </div>
    </nav>
    </div>

    <main class="flex-grow pt-32 pb-12 px-4 relative z-10 max-w-6xl mx-auto w-full">

        <div id="homeSection" class="animate-fade-in">
            <div class="text-center mb-12 space-y-4 pt-8">
                <h1 class="text-5xl md:text-7xl font-bold tracking-tight">
                    <span class="block text-white mb-2">Unlock your new</span>
                    <span class="text-[#63B311]">culinary intelligence</span>
                </h1>
                <p class="text-gray-400 text-lg max-w-2xl mx-auto font-light">
                    100+ recipes generated instantly. Detect ingredients from a single photo.
                </p>
            </div>

            <div class="glass-panel rounded-3xl p-8 mb-8 max-w-4xl mx-auto">
                <div class="relative group cursor-pointer mb-6"
                    onclick="document.getElementById('imageUpload').click()">
                    <div
                        class="border-2 border-dashed border-gray-700 bg-black/20 rounded-2xl h-56 flex flex-col items-center justify-center transition-all group-hover:border-[#63B311] group-hover:bg-black/40">
                        <input type="file" id="imageUpload" accept="image/*" class="hidden">
                        <div id="uploadUiContent" class="text-center">
                            <svg class="w-12 h-12 text-[#63B311] mx-auto mb-3 opacity-80" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            <span class="text-white font-semibold text-lg">Click to scan ingredients</span>
                        </div>
                        <img id="previewImg" class="h-full object-contain hidden rounded-lg" />
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-6">
                    <div class="md:col-span-8">
                        <input type="text" id="promptText" placeholder="Specific cravings? (e.g., Spicy, Soup)"
                            class="w-full h-12 px-6 rounded-full glass-input text-sm">
                    </div>
                    <div class="md:col-span-4 flex items-center h-12 px-6 rounded-full glass-input">
                        <span class="text-gray-400 text-sm mr-auto">Servings</span>
                        <input type="number" id="servingSize" value="2" min="1" max="10"
                            class="w-12 bg-transparent text-right text-white focus:outline-none font-bold">
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="flex justify-between items-center px-2"><label
                            class="text-gray-300 text-sm">Vegan</label><input type="checkbox" id="isVegan"
                            class="toggle-switch"></div>
                    <div class="flex justify-between items-center px-2"><label class="text-gray-300 text-sm">Gluten
                            Free</label><input type="checkbox" id="isGlutenFree" class="toggle-switch"></div>
                    <div class="flex justify-between items-center px-2"><label
                            class="text-gray-300 text-sm">Keto</label><input type="checkbox" id="isLowCarb"
                            class="toggle-switch"></div>
                    <div class="flex justify-between items-center px-2"><label class="text-gray-300 text-sm">Quick
                            Prep</label><input type="checkbox" id="isQuickPrep" class="toggle-switch"></div>
                </div>

                <button id="generateBtn"
                    class="w-full h-14 btn-primary rounded-full text-lg font-bold tracking-wide flex items-center justify-center">
                    <span id="btnText">Generate Recipe</span>
                    <div id="loader"
                        class="hidden ml-3 w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin">
                    </div>
                </button>
            </div>

            <div id="resultArea" class="hidden space-y-6 pb-24 max-w-4xl mx-auto">
                <div class="flex flex-col md:flex-row gap-4">
                    <div id="nutritionGrid" class="grid grid-cols-3 gap-4 flex-grow"></div>

                    <button onclick="location.reload()"
                        class="h-auto min-h-[60px] px-6 rounded-xl border border-red-500/30 text-red-400 hover:bg-red-500/10 transition font-medium flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        Start Over
                    </button>
                </div>

                <div class="glass-panel rounded-3xl p-8">
                    <h2 id="recipeTitle" class="text-3xl font-bold text-white mb-6 font-heading"></h2>
                    <div id="recipeContent" class="space-y-4 text-gray-300 leading-relaxed"></div>
                </div>
            </div>

            <div id="chefFloat"
                class="fixed bottom-10 right-10 z-50 transition-all duration-500 transform translate-y-32 opacity-0 hidden">
                <button id="voiceBtn"
                    class="w-20 h-20 rounded-full flex items-center justify-center chef-btn chef-idle shadow-2xl">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                        <path
                            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                    </svg>
                </button>
            </div>
        </div>

        <div id="recipesSection" class="hidden animate-fade-in pt-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">World Flavors</h2>
                <p class="text-gray-400">Award-winning dishes from Michelin kitchens & street corners.</p>
            </div>
            <div id="recipeGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12"></div>
        </div>

        <div id="aboutSection" class="hidden animate-fade-in max-w-6xl mx-auto pt-8">
            <div
                class="glass-panel rounded-3xl p-10 mb-10 flex flex-col md:flex-row items-center gap-8 border-l-4 border-l-[#63B311] shadow-[0_0_30px_rgba(99,179,17,0.1)]">
                <div
                    class="w-20 h-20 rounded-2xl bg-[#63B311] flex items-center justify-center shadow-lg flex-shrink-0 text-white animate-pulse">
                    <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-white mb-2">CookSaathi AI</h2>
                    <p class="text-gray-400 text-lg">The gap between "What's in my fridge?" and "Dinner is served." We
                        use advanced multimodal AI to turn chaos into cuisine.</p>
                </div>
            </div>
            <div id="featuresGrid" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
        </div>

        <!--change-2.2-->
        <div id="faqSection" class="hidden animate-fade-in max-w-5xl mx-auto pt-8 pb-20">

            <div
                class="glass-panel rounded-3xl p-6 md:p-10 mb-12 border-l-4 border-l-[#63B311] hover:shadow-[0_0_40px_rgba(99,179,17,0.15)] transition duration-500">

                <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 border-b border-white/10 pb-4">How to Master
                    CookSaathi</h2>

                <ul class="space-y-4 text-gray-300 text-base md:text-lg leading-relaxed mb-8">
                    <li class="flex gap-3">
                        <span class="text-[#63B311] font-bold">1.</span>
                        <span>First, click a photo of the core ingredient(s) that you wish to use.</span>
                    </li>
                    <li class="flex gap-3">
                        <span class="text-[#63B311] font-bold">2.</span>
                        <span>Then, click on <span class="text-white font-semibold">Generate Recipe</span>.</span>
                    </li>
                    <li class="flex gap-3">
                        <span class="text-[#63B311] font-bold">3.</span>
                        <span>When detailed instructions pop up with required ingredients and nutritional value, go
                            ahead and rock the kitchen!</span>
                    </li>
                </ul>

                <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
                    <h3 class="text-xl font-bold text-white mb-6">Hands-Free Voice Command Mode</h3>

                    <div class="space-y-8">

                        <div class="flex items-start gap-4">
                            <div
                                class="shrink-0 w-14 h-14 rounded-full border-2 border-red-500 bg-red-500/10 flex items-center justify-center shadow-[0_0_20px_rgba(239,68,68,0.5)] animate-pulse">
                                <svg class="w-7 h-7 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                    <path
                                        d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-white font-semibold text-lg mb-1">The Listening Bot (Red)</p>
                                <p class="text-sm text-gray-400 leading-relaxed">
                                    It's listening to you while giving instructions. You can instruct it to go to the
                                    <span class="text-[#63B311] font-bold">next step</span>, or ask it to go to the
                                    <span class="text-[#63B311] font-bold">previous step</span>. If you didn't catch the
                                    instruction, you can ask it to <span class="text-[#63B311] font-bold">repeat</span>.
                                </p>
                            </div>
                        </div>

                        <div class="flex items-start gap-4">
                            <div
                                class="shrink-0 w-14 h-14 rounded-full border-2 border-blue-500 bg-blue-500/10 flex items-center justify-center shadow-[0_0_20px_rgba(59,130,246,0.5)]">
                                <svg class="w-7 h-7 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                    <path
                                        d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-white font-semibold text-lg mb-1">The Thinking Bot (Blue)</p>
                                <p class="text-sm text-gray-400 leading-relaxed">
                                    When you find out that you are missing a complimenting ingredient, don't worry!
                                    <span class="text-blue-400 font-bold">Ask your doubt</span>, and you get the answer
                                    you seek! A companion that's not gonna let you stop your kitchen grind!
                                </p>
                            </div>
                        </div>

                        <div class="flex items-start gap-4">
                            <div
                                class="shrink-0 w-14 h-14 rounded-full border-2 border-[#63B311] bg-[#63B311]/10 flex items-center justify-center shadow-[0_0_20px_rgba(99,179,17,0.5)]">
                                <svg class="w-7 h-7 text-[#63B311]" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z">
                                    </path>
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-white font-semibold text-lg mb-1">The Narrator (Green)</p>
                                <p class="text-sm text-gray-400 leading-relaxed">
                                    That's the one you're <span class="text-[#63B311] font-bold">listening to!</span>
                                </p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <h2 class="text-3xl font-bold text-white mb-8 text-center">Frequently Asked Questions</h2>
            <div class="grid gap-4">
                <div class="glass-panel p-6 rounded-2xl">
                    <h3 class="text-lg font-bold text-[#63B311] mb-2">What is CookSaathi?</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">CookSaathi is your intelligent culinary partner. It
                        uses advanced AI vision to recognize ingredients from a single photo and creates customized,
                        step-by-step recipes instantly.</p>
                </div>
                <div class="glass-panel p-6 rounded-2xl">
                    <h3 class="text-lg font-bold text-[#63B311] mb-2">What is its purpose?</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">Our mission is to help you "cook with what you
                        have." We aim to reduce food waste and eliminate the stress of deciding what to cook by turning
                        available ingredients into delicious meals.</p>
                </div>
                <div class="glass-panel p-6 rounded-2xl">
                    <h3 class="text-lg font-bold text-[#63B311] mb-2">How to use it from scratch?</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">It's simple: 1. Upload a photo of your ingredients
                        on the Home page. 2. Select dietary filters (Vegan, Keto, etc.). 3. Click "Generate Recipe" and
                        let the AI do the magic!</p>
                </div>
                <div class="glass-panel p-6 rounded-2xl">
                    <h3 class="text-lg font-bold text-[#63B311] mb-2">Can I save the recipes that I asked for?</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">Currently, CookSaathi operates in a "session-based"
                        mode for privacy. We recommend taking a screenshot of your favorite recipes. A "My Cookbook"
                        save feature is coming in the next update!</p>
                </div>
                <div class="glass-panel p-6 rounded-2xl">
                    <h3 class="text-lg font-bold text-[#63B311] mb-2">What future updates can I expect?</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">We are cooking up some great features: User
                        Profiles to save history, calorie tracking integration, community recipe sharing, and
                        multi-language voice support.</p>
                </div>
            </div>

        </div>

        <div id="recipeModal" class="fixed inset-0 z-[100] hidden">
            <div class="absolute inset-0 bg-black/90 backdrop-blur-md transition-opacity" onclick="closeRecipeModal()">
            </div>
            <div class="fixed inset-0 z-10 w-screen overflow-y-auto no-scrollbar flex items-center justify-center p-4">
                <div
                    class="relative rounded-3xl glass-panel max-w-2xl w-full max-h-[80vh] overflow-y-auto no-scrollbar p-8">
                    <button onclick="closeRecipeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    <div id="modalContent"></div>
                </div>
            </div>
        </div>

    </main>

    <!--update-3-->
    <footer class="relative z-10 w-full max-w-6xl mx-auto px-4 pb-8 animate-fade-in">
        <div class="glass-panel rounded-3xl p-8 flex flex-col md:flex-row items-center justify-between gap-6">
            <div class="flex items-center gap-3">
                <img src="logo.png"
                    class="w-8 h-8 object-contain opacity-80 grayscale hover:grayscale-0 transition duration-300"
                    alt="CookSaathi Logo">
                <span class="text-white font-bold font-heading tracking-wide">CookSaathi</span>
            </div>

            <div class="flex flex-wrap justify-center gap-8">
                <a href="#" onclick="switchTab('home', document.getElementById('nav-home')); return false;"
                    class="footer-link text-sm font-medium">Home</a>
                <a href="#" onclick="switchTab('recipes', document.getElementById('nav-recipes')); return false;"
                    class="footer-link text-sm font-medium">World Favorites</a>
                <a href="#" onclick="switchTab('about', document.getElementById('nav-about')); return false;"
                    class="footer-link text-sm font-medium">About Us</a>
                <a href="#" onclick="switchTab('faq', document.getElementById('nav-faq')); return false;"
                    class="footer-link text-sm font-medium">Help</a>
            </div>

            <div class="text-xs text-gray-500 font-light">
                &copy; 2026 CookSaathi. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script type="module">

        // --- 0. MOBILE MENU LOGIC ---
        window.toggleMobileMenu = () => {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
            // Small delay to allow display:block to apply before opacity transition
            setTimeout(() => {
                menu.classList.toggle('opacity-0');
                menu.classList.toggle('scale-95');
            }, 10);
        }

        window.mobileSwitchTab = (tab, btnElement) => {
            // 1. Switch Tab
            switchTab(tab, document.getElementById(`nav-${tab}`)); // Sync with desktop button style

            // 2. Close Menu
            toggleMobileMenu();
        }

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('mobileMenu');
            const btn = document.getElementById('mobileMenuBtn');
            if (menu && !menu.classList.contains('hidden') && !menu.contains(e.target) && !btn.contains(e.target)) {
                toggleMobileMenu();
            }
        });

        //================================================================================
        const API_KEY = ""; // <--- KEY
        //================================================================================

        // --- 1. NAVBAR ANIMATION LOGIC ---
        // Initialize pill on the Home tab on load
        window.addEventListener('load', () => {
            const homeBtn = document.getElementById('nav-home');
            moveNavPill(homeBtn);
        });


        function moveNavPill(element) {
            const indicator = document.getElementById('navIndicator');
            const nav = element.closest('nav');

            // Get position relative to the container (nav)
            const parentRect = nav.getBoundingClientRect();
            const elRect = element.getBoundingClientRect();

            // Calculate absolute left/width based on container
            const left = elRect.left - parentRect.left;
            const width = elRect.width;

            // Apply styles
            indicator.style.left = `${left}px`;
            indicator.style.width = `${width}px`;
            indicator.style.opacity = '1';
        }

        // --- 2. TAB SWITCHING ---
        window.switchTab = (tab, btnElement) => {
            // 1. Hide ALL sections (Added 'faqSection' to the list)
            ['homeSection', 'recipesSection', 'aboutSection', 'faqSection'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            });

            // 2. Reset ALL nav buttons (Added 'nav-faq' to the list)
            ['nav-home', 'nav-recipes', 'nav-about', 'nav-faq'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.classList.remove('active', 'text-white');
                    el.classList.add('text-gray-400');
                }
            });

            // 3. Show the selected section
            if (tab === 'home') document.getElementById('homeSection').classList.remove('hidden');
            if (tab === 'recipes') {
                document.getElementById('recipesSection').classList.remove('hidden');
                renderGlobalRecipes();
            }
            if (tab === 'about') {
                document.getElementById('aboutSection').classList.remove('hidden');
                renderAbout();
            }
            // NEW: Handle FAQ Tab
            if (tab === 'faq') {
                document.getElementById('faqSection').classList.remove('hidden');
            }

            // 4. Update the Nav Pill position
            if (btnElement && btnElement.id.startsWith('nav')) {
                btnElement.classList.add('active');
                btnElement.classList.remove('text-gray-400');
                moveNavPill(btnElement);
            }
        }

        // --- 3. EXPANDED RECIPE DATABASE ---
        const globalRecipesDB = [
            // Original 3
            { id: 1, title: "Authentic Carbonara", origin: "Rome, Italy", cal: "450", time: "25m", img: "https://images.unsplash.com/photo-1612874742237-6526221588e3?auto=format&fit=crop&w=800&q=80", desc: "Classic Roman technique. No cream, just eggs, pecorino, and guanciale.", ingredients: ["Spaghetti", "Guanciale", "Eggs", "Pecorino Romano"], steps: ["Boil pasta", "Render guanciale", "Mix eggs & cheese", "Emulsify off heat"] },
            { id: 2, title: "Spicy Miso Ramen", origin: "Sapporo, Japan", cal: "520", time: "45m", img: "https://images.unsplash.com/photo-1591814468924-caf88d1232e1?auto=format&fit=crop&w=800&q=80", desc: "Rich umami broth topped with chashu pork, corn, and spicy butter.", ingredients: ["Ramen Noodles", "Red Miso", "Pork Belly", "Corn"], steps: ["Simmer broth", "Cook noodles", "Sear pork", "Assemble bowl"] },
            { id: 3, title: "Butter Chicken", origin: "Delhi, India", cal: "600", time: "50m", img: "https://images.unsplash.com/photo-1603894584373-5ac82b2ae398?auto=format&fit=crop&w=800&q=80", desc: "Tandoori chicken simmered in a velvety, spiced tomato cream sauce.", ingredients: ["Chicken Thighs", "Tomato Puree", "Cream", "Kasuri Methi"], steps: ["Marinate chicken", "Grill chicken", "Simmer sauce", "Finish with cream"] },

            // New Indian Veg
            { id: 4, title: "Royal Dal Makhani", origin: "Punjab, India", cal: "480", time: "8h (slow cook)", img: "https://www.funfoodfrolic.com/wp-content/uploads/2023/04/Dal-Makhani-1.jpg", desc: "Black lentils slow-cooked overnight with butter and cream for rich texture.", ingredients: ["Black Urad Dal", "Kidney Beans", "Butter", "Fresh Cream", "Ginger Garlic Paste"], steps: ["Soak lentils overnight", "Slow cook with spices", "Temper with butter/garlic", "Finish with cream"] },
            { id: 5, title: "Paneer Lababdar", origin: "North India", cal: "550", time: "40m", img: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?auto=format&fit=crop&w=800&q=80", desc: "Soft cottage cheese cubes in a creamy, onion-tomato gravy with cashews.", ingredients: ["Paneer", "Cashews", "Tomatoes", "Onions", "Cardamom"], steps: ["Saut√© spices", "Blend onion/tomato/cashew", "Simmer gravy", "Add paneer cubes"] },

            // New Michelin/Acclaimed
            { id: 6, title: "Miso Black Cod", origin: "Nobu Style", cal: "380", time: "3 Days (Prep)", img: "https://www.foodandwine.com/thmb/gal2eelnVqNc4_iI4CmWBi0-YGQ=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/Black-Cod-with-Miso-FT-RECIPE1023-c8b5a15cc2eb4d8a9cbb6881c446789b.jpg", desc: "The legendary sweet-savory fish dish popularized by Chef Nobu Matsuhisa.", ingredients: ["Black Cod Fillets", "White Miso", "Mirin", "Sake", "Sugar"], steps: ["Make miso marinade", "Marinate fish for 72h", "Wipe off excess miso", "Broil until caramelized"] },
            { id: 7, title: "Ratatouille (Confit Byaldi)", origin: "Provence, France", cal: "220", time: "90m", img: "https://images.unsplash.com/photo-1572453800999-e8d2d1589b7c?auto=format&fit=crop&w=800&q=80", desc: "Thomas Keller's refined version. Paper-thin vegetable slices baked to perfection.", ingredients: ["Zucchini", "Eggplant", "Roma Tomatoes", "Bell Pepper Sauce"], steps: ["Make piperade sauce base", "Mandoline slice veggies", "Arrange in spiral", "Bake covered then uncovered"] },
            { id: 8, title: "Lobster Thermidor", origin: "Paris, France", cal: "750", time: "1h", img: "https://images.unsplash.com/photo-1551248429-40975aa4de74?auto=format&fit=crop&w=800&q=80", desc: "A French classic. Lobster meat cooked in a rich wine sauce, stuffed back into the shell, and browned.", ingredients: ["Whole Lobster", "Cognac", "Gruy√®re Cheese", "Mustard", "Egg Yolks"], steps: ["Cook lobster & remove meat", "Make b√©chamel with Cognac", "Mix meat & sauce", "Broil with cheese"] },
            { id: 9, title: "Osso Buco", origin: "Milan, Italy", cal: "680", time: "3h", img: "https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=800&q=80", desc: "Cross-cut veal shanks braised with vegetables, white wine and broth.", ingredients: ["Veal Shanks", "White Wine", "Vegetables", "Gremolata (Lemon/Parsley)"], steps: ["Dredge & sear veal", "Saut√© mirepoix", "Braise in wine/stock", "Top with gremolata"] }
        ];

        window.renderGlobalRecipes = () => {
            const grid = document.getElementById('recipeGrid');
            if (grid.innerHTML) return;
            grid.innerHTML = globalRecipesDB.map(r => `
                <div class="glass-panel rounded-2xl overflow-hidden cursor-pointer group hover:scale-[1.02] transition duration-300" onclick="openRecipeModal(${r.id})">
                    <div class="h-48 overflow-hidden relative">
                        <img src="${r.img}" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition duration-500 group-hover:scale-110">
                        <div class="absolute bottom-2 left-2 bg-black/60 backdrop-blur-md px-3 py-1 rounded-lg border border-white/10">
                            <span class="text-[#63B311] text-xs font-bold uppercase tracking-wider">${r.origin}</span>
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="text-lg font-bold text-white mb-2 leading-tight">${r.title}</h3>
                        <p class="text-gray-400 text-sm line-clamp-2">${r.desc}</p>
                        <div class="flex gap-4 text-xs text-gray-500 mt-4 border-t border-white/10 pt-3">
                            <span class="flex items-center gap-1 text-gray-300"><span class="text-[#63B311]">üî•</span> ${r.cal}</span>
                            <span class="flex items-center gap-1 text-gray-300"><span class="text-[#63B311]">‚è±</span> ${r.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- 4. HYPE ABOUT US ---
        window.renderAbout = () => {
            const grid = document.getElementById('featuresGrid');
            if (grid.innerHTML) return;
            const features = [
                { title: "Vision Intelligence", icon: "M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z", desc: "Don't guess. We scan textures, labels, and quantities with 98% accuracy using Gemini 1.5 Flash." },
                { title: "Dietary Alchemy", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z", desc: "One click transforms any greasy favorite into a Keto, Vegan, or Gluten-Free masterpiece." },
                { title: "Hands-Free Command", icon: "M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z", desc: "Keep your screen clean. Navigate steps and ask cooking questions just by speaking." },
                { title: "Global Knowledge", icon: "M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064", desc: "From street food in Delhi to fine dining in Paris, access a curated database of flavors." }
            ];
            grid.innerHTML = features.map(f => `
                <div class="glass-panel p-8 rounded-2xl feature-card cursor-default relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-[#63B311] opacity-5 rounded-full blur-3xl -mr-16 -mt-16 transition group-hover:opacity-10"></div>
                    <div class="icon-box w-14 h-14 bg-[#63B311]/10 rounded-xl flex items-center justify-center text-[#63B311] mb-6 transition-transform duration-300 border border-[#63B311]/20">
                        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${f.icon}"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3">${f.title}</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">${f.desc}</p>
                </div>
            `).join('');
        }

        // --- WAVE ANIMATION ---
        (function initWave() {
            const canvas = document.getElementById('waveCanvas');
            const ctx = canvas.getContext('2d');
            let w, h, lines = [];
            const gap = 45;
            function resize() {
                w = canvas.width = window.innerWidth;
                h = canvas.height = window.innerHeight;
                lines = [];
                for (let y = 0; y < h + gap; y += gap) {
                    lines.push({ y, amp: 20 + Math.random() * 20, speed: 0.002 + Math.random() * 0.003, offset: Math.random() * Math.PI * 2 });
                }
            }
            let time = 0;
            function animate() {
                ctx.clearRect(0, 0, w, h);
                time++;
                ctx.lineWidth = 1;
                lines.forEach(l => {
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(99, 179, 17, 0.15)`;
                    for (let x = 0; x <= w; x += 10) {
                        ctx.lineTo(x, l.y + Math.sin(x * 0.003 + time * l.speed + l.offset) * l.amp);
                    }
                    ctx.stroke();
                });
                requestAnimationFrame(animate);
            }
            window.addEventListener('resize', resize);
            resize(); animate();
        })();

        // --- CORE LOGIC (AI, Voice, Modal) ---

        // ... (Previous logic for File Upload, AI Generation, Voice remains identical) ...
        const fileInput = document.getElementById('imageUpload');
        const previewImg = document.getElementById('previewImg');
        const uploadContent = document.getElementById('uploadUiContent');
        const generateBtn = document.getElementById('generateBtn');
        const resultArea = document.getElementById('resultArea');
        const voiceBtn = document.getElementById('voiceBtn');
        const chefFloat = document.getElementById('chefFloat');
        let imgBase64 = null, imgMime = null, fullRecipeMarkdown = "", stepsData = [], currentStep = 0;
        let recognition, isListening = false;

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    previewImg.classList.remove('hidden');
                    uploadContent.classList.add('hidden');
                    imgBase64 = e.target.result.split(',')[1];
                    imgMime = file.type;
                };
                reader.readAsDataURL(file);
            }
        });

        generateBtn.addEventListener('click', async () => {
            if (!imgBase64) return alert("Upload an image first.");

            generateBtn.disabled = true;
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('btnText').innerText = "Analyzing...";

            // Constraints with change-2
            const diet = [
                document.getElementById('isVegan').checked ? "Vegan" : "",
                document.getElementById('isGlutenFree').checked ? "Gluten-Free" : "",
                document.getElementById('isLowCarb').checked ? "Keto" : "",
                document.getElementById('isQuickPrep').checked ? "Quick (<30m)" : ""
            ].filter(Boolean).join(", ");
            const note = document.getElementById('promptText').value;
            const servings = document.getElementById('servingSize').value;

            const prompt = `Analyze image. Create recipe. ${servings} Servings. ${diet}. Note: ${note}.
            Format: # [Name] \n Calories: [X] | Protein: [X] | Carbs: [X] \n ## Ingredients \n - [Item] \n ## Instructions \n 1. [Step]`;

            try {
                // FIX 1: Use 'v1alpha' endpoint for bleeding-edge models like gemini-2.5-flash
                const resp = await fetch(`https://generativelanguage.googleapis.com/v1alpha/models/gemini-2.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                { inlineData: { mimeType: imgMime, data: imgBase64 } }
                            ]
                        }]
                    })
                });

                const data = await resp.json();

                // FIX 2: Debugging - If this logs an error, we know the API key/Model is rejected
                if (data.error) {
                    console.error("API Error:", data.error);
                    throw new Error(`Google API Error: ${data.error.message}`);
                }

                // FIX 3: Safety Check - Ensure 'candidates' exists before reading [0]
                if (!data.candidates || data.candidates.length === 0) {
                    console.warn("Blocked Response:", data);
                    throw new Error("The AI blocked the request (Safety/Privacy filters).");
                }

                fullRecipeMarkdown = data.candidates[0].content.parts[0].text;
                renderRecipe(fullRecipeMarkdown);

                chefFloat.classList.remove('hidden');
                setTimeout(() => chefFloat.classList.remove('translate-y-32', 'opacity-0'), 100);

            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
            } finally {
                generateBtn.disabled = false;
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('btnText').innerText = "Generate Recipe";
                if (fullRecipeMarkdown) generateBtn.classList.add('hidden');
            }
        });

        function renderRecipe(md) {
            resultArea.classList.remove('hidden');
            resultArea.scrollIntoView({ behavior: 'smooth' });
            const lines = md.split('\n');
            let html = '', statsHtml = '';
            stepsData = []; currentStep = 0;

            lines.forEach(line => {
                let clean = line.replace(/\*\*/g, '').trim();
                if (!clean) return;
                if (clean.startsWith('# ') && !clean.startsWith('##')) document.getElementById('recipeTitle').innerText = clean.replace('#', '');
                else if (clean.startsWith('Calories:')) {
                    clean.split('|').forEach(s => {
                        const [l, v] = s.split(':');
                        statsHtml += `<div class="bg-white/5 rounded-xl p-3 text-center border border-white/10"><div class="text-[#63B311] font-bold text-xl">${v || '-'}</div><div class="text-xs text-gray-400 uppercase">${l}</div></div>`;
                    });
                    document.getElementById('nutritionGrid').innerHTML = statsHtml;
                }
                else if (clean.match(/^\d+\./)) {
                    const text = clean.replace(/^\d+\./, '').trim();
                    stepsData.push(text);
                    html += `<div id="step-${stepsData.length - 1}" class="p-4 rounded-xl bg-white/5 mb-3 border border-transparent transition"><span class="text-[#63B311] font-bold text-lg mr-2">${stepsData.length}.</span>${text}</div>`;
                }
                // Added check to skip the "Stats" word in the rendered HTML and change-3
                else if (clean.startsWith('##') && !clean.includes('Stats')) {
                    html += `<h3 class="text-xl font-bold text-[#63B311] mt-6 mb-3">${clean.replace('##', '')}</h3>`;
                }
                else if (clean.startsWith('-')) html += `<li class="text-gray-300 ml-5 marker:text-[#63B311]">${clean.substring(1)}</li>`;
            });
            document.getElementById('recipeContent').innerHTML = html;
        }

        voiceBtn.addEventListener('click', () => {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return alert("No Voice Support");

            if (!isListening) {
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.lang = 'en-US';

                recognition.onstart = () => {
                    isListening = true;
                    setVisuals('listening'); // RED
                };
                recognition.onresult = async (e) => {
                    const trans = e.results[e.results.length - 1][0].transcript.toLowerCase().trim();
                    console.log("Heard:", trans);

                    // COMMANDS
                    if (trans.includes('next')) { navStep(1); return; }
                    if (trans.includes('previous') || trans.includes('back')) { navStep(-1); return; }
                    if (trans.includes('repeat')) { navStep(0); return; }

                    // QUERY
                    recognition.stop();
                    setVisuals('answering'); // BLUE (Thinking)


                    // NEW CODE (Human Persona)// We tell Gemini to act like a Chef friend, use fillers, and avoid formatting.

                    const prompt = `You are CookSaathi, a warm, encouraging, and witty chef companion cooking alongside the user.
                    Context: The user is making ${document.getElementById('recipeTitle').innerText}.
                    Current Step Details: "${stepsData[currentStep]}".
                    User said: "${trans}".

                    Instructions for your reply:
                    1. Answer as if you are talking to a friend in the kitchen.
                    2. Be helpful but conversational. Use natural fillers (e.g., "Well," "Alright," "So").
                    3. Keep it under 2 sentences.
                    4. CRITICAL: Do NOT use asterisks, markdown, or lists. strictly plain text only.`;

                    try {
                        const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`, {
                            method: 'POST', body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                        });
                        const d = await r.json();
                        setVisuals('answering'); // Stay Blue while answering query
                        await speak(d.candidates[0].content.parts[0].text);
                        if (isListening) recognition.start();
                        setVisuals('listening'); // Back to Red
                    } catch (e) { console.error(e); }
                };
                recognition.start();
            } else {
                isListening = false;
                if (recognition) recognition.stop();
                window.speechSynthesis.cancel();
                setVisuals('idle');
            }
        });

        function setVisuals(state) {
            voiceBtn.className = `w-20 h-20 rounded-full flex items-center justify-center chef-btn shadow-2xl transition-all duration-300`;
            voiceBtn.classList.remove('chef-idle', 'chef-listening', 'chef-answering', 'chef-narrating');

            if (state === 'idle') voiceBtn.classList.add('chef-idle');
            if (state === 'listening') voiceBtn.classList.add('chef-listening');
            if (state === 'answering') voiceBtn.classList.add('chef-answering');
            if (state === 'narrating') voiceBtn.classList.add('chef-narrating');
        }
        // Removes Markdown and special characters so the voice flows smoothly
        function cleanTextForSpeech(text) {
            return text
                .replace(/[*#_`]/g, '') // Remove markdown symbols
                .replace(/\n/g, '. ')   // Turn new lines into pauses
                .replace(/\s+/g, ' ')   // Remove double spaces
                .trim();
        }

        function speak(text) {
            return new Promise(res => {
                window.speechSynthesis.cancel(); // Stop previous audio

                // 1. Clean the text first
                const spokenText = cleanTextForSpeech(text);
                const u = new SpeechSynthesisUtterance(spokenText);

                // 2. Find a "Human-sounding" voice
                const voices = window.speechSynthesis.getVoices();

                // Priority list: Look for Google voices (usually higher quality) or Microsoft Natural
                const preferredVoice = voices.find(v =>
                    (v.name.includes("Google") && v.lang.includes("en-US")) ||
                    (v.name.includes("Natural") && v.lang.includes("en-US")) ||
                    (v.name.includes("Samantha") && v.lang.includes("en-US")) // Good macOS voice
                );

                if (preferredVoice) {
                    u.voice = preferredVoice;
                }

                // 3. Tweak Pitch and Rate for natural flow
                u.pitch = 1.1; // Slightly higher pitch often sounds more energetic
                u.rate = 1.05; // A tiny bit faster feels more conversational than the slow robotic default

                u.onend = res;
                window.speechSynthesis.speak(u);
            });
        }

        // IMPORTANT: Voices load asynchronously. We need to trigger loading early.
        window.speechSynthesis.getVoices();

        async function navStep(dir) {
            let next = currentStep + dir;
            if (dir === 0) next = currentStep;
            if (next >= 0 && next < stepsData.length) {
                currentStep = next;
                document.querySelectorAll('[id^="step-"]').forEach(el => el.classList.remove('step-active', 'bg-white/10'));
                const el = document.getElementById(`step-${currentStep}`);
                if (el) {
                    el.classList.add('step-active', 'bg-white/10');
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                setVisuals('narrating');
                await speak(stepsData[currentStep]);
                setVisuals('listening');
            }
        }

        window.openRecipeModal = (id) => {
            const r = globalRecipesDB.find(x => x.id === id);
            document.getElementById('modalContent').innerHTML = `
                <div class="flex gap-4 mb-4"><img src="${r.img}" class="w-24 h-24 rounded-xl object-cover"><div><h2 class="text-2xl font-bold text-white">${r.title}</h2><p class="text-[#63B311]">${r.origin}</p></div></div>
                <h3 class="font-bold text-white mt-4 border-b border-white/10 pb-2">Ingredients</h3><ul class="text-gray-300 ml-4 list-disc">${r.ingredients.map(i => `<li>${i}</li>`).join('')}</ul>
                <h3 class="font-bold text-white mt-4 border-b border-white/10 pb-2">Steps</h3><ol class="text-gray-300 ml-4 list-decimal">${r.steps.map(s => `<li>${s}</li>`).join('')}</ol>
            `;
            document.getElementById('recipeModal').classList.remove('hidden');
        }
        window.closeRecipeModal = () => document.getElementById('recipeModal').classList.add('hidden');

    </script>
</body>

</html>